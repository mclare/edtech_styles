<!-- OrgId {OrgId} - OrgName {OrgName} - OrgUnitId {OrgUnitId} -->
<div id="brock-org-status"></div>
<script>

function format(resp) {
  try {
    var json = JSON.parse(resp);
    return JSON.stringify(json, null, '\t');
  } catch(e) {
    return resp;
  }
}

function brockOrgStatus (result) {
	console.log("brockOrgStatus called");
	
    console.log("Active Status "+result.IsActive);
	
	message = "Cannot determine if site is active or not.";
	dateMessage = "";
	dateInstructions = " &gt; uncheck or modify <strong>Course has start date</strong> ";
	
	if (result.IsActive == true) {
		
		message = "<strong>Site Status: Active.</strong>";

		dateActive = false;
		if (result.StartDate == null)  dateActive = true;
		today = new Date();
		console.log("Looking harder at date. It is now "+today);	

		var startDate = new Date(result.StartDate);
		var endDate = new Date(result.EndDate);

		//Working date logic for console 
		if (startDate.getTime() < today) {
			console.log("StartDate is before today "+result.StartDate);
			dateMessage = ", and set to start in the future";
		}
		if (endDate.getTime() > today) {
			console.log("EndDate is after today "+result.EndDate);
		}
		if (startDate.getTime() < today && endDate.getTime() > today) {
			console.log("Sweet spot");
			message = "<strong>Site Status: Active</strong><br />Students gained access "+startDate+" Today is"+Date.today().toString("dddd d MMMM yyyy");
		}
}

	if (result.IsActive == false) message = "<strong>Site Status: Inactive"+dateMessage+".</strong><p>When ready to teach with this site, Instructors can activate their course in the Navbar above. <strong>Course Admin</strong> &gt; <strong>Course Offering Information</strong> &gt; scroll down the page to find the <strong>Course is active</strong>checkbox and select it "+dateInstructions+" &gt; <strong>Save</strong> at the bottom of the page.</p>";
	
	//Place message in div
  	document.getElementById('brock-org-status').innerHTML = message;
 
	
}

function brockOrgStatusCheck () {
	console.log("brockOrgStatusCheck called");
	//jQuery AJAX call for JSON info
	$.get("/d2l/api/lp/1.36/courses/{OrgUnitId}", function(data, status){
  
	  console.log("Result Formated");
	  result = format(data);
	  console.log(result);
	  
	  brockOrgStatus(result);
	});
}

//Wait until the page is fully loaded!
window.addEventListener('load', function () {
   brockOrgStatusCheck();
})

</script>